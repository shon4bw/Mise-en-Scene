{% extends 'base.html' %}

{% block content %}
<div class="d-flex flex-column align-items-center">

  <div>
    {% if person.image %}
      <img class="big_profile_box" src="{{ person.image.url }}" alt="프로필 사진">
    {% else %}
      <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
      </svg> 
    {% endif %}
  </div>
  <span class="feed_name_txt">{{ person.username }} </span>

  {% with followings=person.followings.all followers=person.followers.all %}
    <div>
      <div>
      팔로잉 수 : <span id="followings-cnt"> {{ followings|length }} </span> 
      / 팔로워 수 : <span id="followers-cnt"> {{ followers|length }} </span> 
      </div>
    </div>
    {% if user != person %}
      <div>
        <form id="follow-form" data-user-id="{{ person.pk }}" method="POST">
          {% csrf_token %}
          {% if user in followers %}
            <input type="submit" id="follow-btn" value="언팔로우">
          {% else %}
            <input type="submit" id="follow-btn" value="팔로우">
          {% endif %}
        </form>
      </div>
    {% endif %}
  {% endwith %}
</div>

  <hr>
  <h5>게시글</h5>
  <!--
  {% for article in articles %}
  
  {% endfor %}
  -->

{% endblock content %}

{% block script %}
<script>
  const followForm = document.querySelector('#follow-form')
  followForm.addEventListener('submit', (e)=>{
    e.preventDefault()
    // console.log('확인!!!')
    //const userId = e.target.dataset.userId
    const userId = e.target.dataset.userId
    const requestUrl = `/accounts/${userId}/follow/`
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value
    
    axios.post(requestUrl, {}, {headers: {'X-CSRFToken': csrftoken}})
      .then((res)=>{
        const followingsCnt = document.querySelector('#followings-cnt')
        followingsCnt.innerText = res.data.following_count

        const followersCnt = document.querySelector('#followers-cnt')
        followersCnt.innerText = res.data.follower_count

        const followBtn = document.querySelector('#follow-btn')
        followBtn.value = res.data.followed ? '언팔로우' : '팔로우'
      })
      .catch((err)=>{
        window.alert(err)
      })

  })
</script>
{% endblock script %}